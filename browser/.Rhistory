dotplot <- makeDotPlot(seurat_object = neocortex_subset,
mode = 'genes_by_area',
idents_use = NULL,
# group = 'rg_early',
# area = 'pfc; v1',
genes_list = markers$Gene %>% unique,
group_by = 'cortical_area',
split_by = NULL,
scale = FALSE,
title = 'All neocortex cells',
# color_scale = 'red_yellow_blue',
color_scale = 'viridis'
scale_by = 'gene',
ggsave(plot = dotplot, filename = file.path(out_dir, "markers_viridis.pdf"),
width = 70/4.75, height = 5/2.6, units = "in", device = "pdf")
dotplot <- makeDotPlot(seurat_object = neocortex_subset,
mode = 'genes_by_area',
idents_use = NULL,
# group = 'rg_early',
# area = 'pfc; v1',
genes_list = markers$Gene %>% unique,
group_by = 'cortical_area',
split_by = NULL,
scale = FALSE,
title = 'All neocortex cells',
# color_scale = 'red_yellow_blue',
color_scale = 'viridis',
scale_by = 'gene',
max_size = 4)
out_dir <- here("dotplots_area_validation/out")
fs::dir_create(here("dotplots_area_validation/out"))
ggsave(plot = dotplot, filename = file.path(out_dir, "markers_viridis.pdf"),
width = 70/4.75, height = 5/2.6, units = "in", device = "pdf")
viridis(n = 100, option = 'plasma', end = 0.95)
source(here("tfs_and_gene_function/R/funcs/makeDotPlot.R"))
dotplot <- makeDotPlot(seurat_object = neocortex_subset,
mode = 'genes_by_area',
idents_use = NULL,
# group = 'rg_early',
# area = 'pfc; v1',
genes_list = markers$Gene %>% unique,
group_by = 'cortical_area',
split_by = NULL,
scale = FALSE,
title = 'All neocortex cells',
# color_scale = 'red_yellow_blue',
color_scale = 'viridis',
scale_by = 'gene',
max_size = 4)
dotplot
ggsave(plot = dotplot, filename = file.path(out_dir, "markers_viridis.pdf"),
width = 70/4.75, height = 5/2.6, units = "in", device = "pdf")
source(here("tfs_and_gene_function/R/funcs/makeDotPlot.R"))
dotplot <- makeDotPlot(seurat_object = neocortex_subset,
mode = 'genes_by_area',
idents_use = NULL,
# group = 'rg_early',
# area = 'pfc; v1',
genes_list = markers$Gene %>% unique,
group_by = 'cortical_area',
split_by = NULL,
scale = FALSE,
title = 'All neocortex cells',
# color_scale = 'red_yellow_blue',
color_scale = 'viridis',
scale_by = 'gene',
max_size = 4)
ggsave(plot = dotplot, filename = file.path(out_dir, "markers_viridis.pdf"),
width = 70/4.75, height = 5/2.6, units = "in", device = "pdf")
source(here("tfs_and_gene_function/R/funcs/makeDotPlot.R"))
dotplot <- makeDotPlot(seurat_object = neocortex_subset,
mode = 'genes_by_area',
idents_use = NULL,
# group = 'rg_early',
# area = 'pfc; v1',
genes_list = markers$Gene %>% unique,
group_by = 'cortical_area',
split_by = NULL,
scale = FALSE,
title = 'All neocortex cells',
# color_scale = 'red_yellow_blue',
color_scale = 'viridis',
scale_by = 'gene',
max_size = 4)
ggsave(plot = dotplot, filename = file.path(out_dir, "markers_viridis.pdf"),
width = 70/4.75, height = 5/2.6, units = "in", device = "pdf")
source(here("tfs_and_gene_function/R/funcs/makeDotPlot.R"))
dotplot <- makeDotPlot(seurat_object = neocortex_subset,
mode = 'genes_by_area',
idents_use = NULL,
# group = 'rg_early',
# area = 'pfc; v1',
genes_list = markers$Gene %>% unique,
group_by = 'cortical_area',
split_by = NULL,
scale = FALSE,
title = 'All neocortex cells',
# color_scale = 'red_yellow_blue',
color_scale = 'viridis',
scale_by = 'gene',
max_size = 4)
ggsave(plot = dotplot, filename = file.path(out_dir, "markers_viridis.pdf"),
width = 70/4.75, height = 5/2.6, units = "in", device = "pdf")
source(here("tfs_and_gene_function/R/funcs/makeDotPlot.R"))
dotplot <- makeDotPlot(seurat_object = neocortex_subset,
mode = 'genes_by_area',
idents_use = NULL,
# group = 'rg_early',
# area = 'pfc; v1',
genes_list = markers$Gene %>% unique,
group_by = 'cortical_area',
split_by = NULL,
scale = FALSE,
title = 'All neocortex cells',
# color_scale = 'red_yellow_blue',
color_scale = 'viridis',
scale_by = 'gene',
max_size = 4)
ggsave(plot = dotplot, filename = file.path(out_dir, "markers_viridis.pdf"),
width = 70/4.75, height = 5/2.6, units = "in", device = "pdf")
dotplot <- makeDotPlot(seurat_object = neocortex_subset,
mode = 'genes_by_area',
idents_use = NULL,
# group = 'rg_early',
# area = 'pfc; v1',
genes_list = markers$Gene %>% unique,
group_by = 'cortical_area',
split_by = NULL,
scale = FALSE,
title = 'All neocortex cells',
color_scale = 'red_yellow_blue',
# color_scale = 'viridis',
scale_by = 'gene',
max_size = 4)
ggsave(plot = dotplot, filename = file.path(out_dir, "markers_ryb.pdf"),
width = 70/4.75, height = 5/2.6, units = "in", device = "pdf")
View(markers_allen)
View(markers)
rbind(markers, markers_allen)
rbind(markers[,1], markers_alleN[,1])
rbind(markers[,1], markers_allen[,1])
c((markers[,1], markers_allen[,1]))
c((markers[,1], markers_allen[,1])
markers <- c(markers[,1], markers_allen[,1])
markers <- c(markers[,1], markers_allen[,1]) %>% unique
markers <- markers %>% unique
markers
dotplot <- makeDotPlot(seurat_object = neocortex_subset,
mode = 'genes_by_area',
idents_use = NULL,
# group = 'rg_early',
# area = 'pfc; v1',
genes_list = markers$Gene %>% unique,
group_by = 'cortical_area',
split_by = NULL,
scale = FALSE,
title = 'All neocortex cells',
color_scale = 'red_yellow_blue',
# color_scale = 'viridis',
scale_by = 'gene',
max_size = 4)
markers <- reduce(markers[,1], markers_allen[,1]) %>% unique
markers <- reduce(markers, markers_allen[,1]) %>% unique
markers
markers %>% reduce
markers %>% combine
markers %>% dplyr::combine
markers %>% dplyr::combine(.)
markers %>% dplyr::combine(.) %>% unique
markers <- markers %>% dplyr::combine(.) %>% unique
dotplot <- makeDotPlot(seurat_object = neocortex_subset,
mode = 'genes_by_area',
idents_use = NULL,
# group = 'rg_early',
# area = 'pfc; v1',
genes_list = markers$Gene %>% unique,
group_by = 'cortical_area',
split_by = NULL,
scale = FALSE,
title = 'All neocortex cells',
color_scale = 'red_yellow_blue',
# color_scale = 'viridis',
scale_by = 'gene',
max_size = 4)
dotplot <- makeDotPlot(seurat_object = neocortex_subset,
mode = 'genes_by_area',
idents_use = NULL,
# group = 'rg_early',
# area = 'pfc; v1',
genes_list = markers,
group_by = 'cortical_area',
split_by = NULL,
scale = FALSE,
title = 'All neocortex cells',
color_scale = 'red_yellow_blue',
# color_scale = 'viridis',
scale_by = 'gene',
max_size = 4)
ggsave(plot = dotplot, filename = file.path(out_dir, "markers_ryb.pdf"),
width = 70/4.75, height = 5/2.6, units = "in", device = "pdf")
# here::set_here("/home/csandoval/cse-phd/second-trimester/")
here::i_am(path = "browser/seurat_to_h5ad.Rmd")
wholebrain <- read_rds(here("whole_brain/data/wholebrain_v3.2.3.rds"))
p_load(here)
wholebrain <- read_rds(here("whole_brain/data/wholebrain_v3.2.3.rds"))
wholebrain <- read_rds(here("data/wholebrain/wholebrain_v3.2.3.rds"))
wholebrain <- read_rds(here("data/whole_brain/wholebrain_v3.2.3.rds"))
sms("read_rds whole_brain")
wholebrain <- read_rds(here("data/whole_brain/wholebrain_v3.2.3.rds"))
screen -S wholebrain_210428
metadata <- read_tsv(here("data/whole_brain/wholebrain_clusters_and_metadata.txt"))
here::i_am(path = "browser/seurat_to_h5ad.Rmd")
# here() starts at /home/csandoval/cse-phd/second-trimester
p_load(here)
metadata <- read_tsv(here("data/whole_brain/wholebrain_clusters_and_metadata.txt"))
metadata %>% set_rownames(., value = .$cell.name)
tmp <- metadata %>%
# rownames_to_column("cell_id") %>%
set_colnames(colnames(.) %>% tolower %>% str_replace_all("[.]", "_")) %>%
select(cell_id = cell_name, age, individual, brain_region = structure, area, lamina,
cell_type = cell_type_v2, cluster_label = clusterv2,
ngene, numi, percent_mito, percent_ribo, ncount_rna, nfeature_rna) %>%
mutate_at(.vars = c("cluster_label"), .funs = tolower) %>%
mutate_at(.vars = c("cluster_label", "cell_type"),
.funs = ~ str_replace(., "^neuron", "excitatory_neuron") %>%
str_replace("radialglia|rg", "radial_glia")) %>%
str_replace("([:digit:]+)[:alpha:]+$", "\1"))
tmp <- metadata %>%
# rownames_to_column("cell_id") %>%
set_colnames(colnames(.) %>% tolower %>% str_replace_all("[.]", "_")) %>%
select(cell_id = cell_name, age, individual, brain_region = structure, area, lamina,
cell_type = cell_type_v2, cluster_label = clusterv2,
ngene, numi, percent_mito, percent_ribo, ncount_rna, nfeature_rna) %>%
mutate_at(.vars = c("cluster_label"), .funs = tolower) %>%
mutate_at(.vars = c("cluster_label", "cell_type"),
.funs = ~ str_replace(., "^neuron", "excitatory_neuron") %>%
str_replace("radialglia|rg", "radial_glia") %>%
str_replace("([:digit:]+)[:alpha:]+$", "\1"))
p_load(stringr)
tmp <- metadata %>%
# rownames_to_column("cell_id") %>%
set_colnames(colnames(.) %>% tolower %>% str_replace_all("[.]", "_")) %>%
select(cell_id = cell_name, age, individual, brain_region = structure, area, lamina,
cell_type = cell_type_v2, cluster_label = clusterv2,
ngene, numi, percent_mito, percent_ribo, ncount_rna, nfeature_rna) %>%
mutate_at(.vars = c("cluster_label"), .funs = tolower) %>%
mutate_at(.vars = c("cluster_label", "cell_type"),
.funs = ~ str_replace(., "^neuron", "excitatory_neuron") %>%
str_replace("radialglia|rg", "radial_glia") %>%
str_replace("([:digit:]+)[:alpha:]+$", "\1"))
View(metadata)
View(tmp)
View(metadata)
View(tmp)
View(metadata)
metadata %>%
# rownames_to_column("cell_id") %>%
set_colnames(colnames(.) %>% tolower %>% str_replace_all("[.]", "_")) %>%
select(cell_id = cell_name, age, individual, brain_region = structure, area, lamina,
cell_type = cell_type_v2, cluster_label = clusterv2,
ngene, numi, percent_mito, percent_ribo, ncount_rna, nfeature_rna) %>%
mutate_at(.vars = c("cluster_label"), .funs = tolower) %>%
mutate_at(.vars = c("cluster_label", "cell_type"),
.funs = ~ str_replace(., "^neuron", "excitatory_neuron") %>%
str_replace("radialglia|rg", "radial_glia") %>%
str_replace("([:digit:]+)[:alpha:]+$", "\1"))
metadata %>%
# rownames_to_column("cell_id") %>%
set_colnames(colnames(.) %>% tolower %>% str_replace_all("[.]", "_")) %>%
select(cell_id = cell_name, age, individual, brain_region = structure, area, lamina,
cell_type = cell_type_v2, cluster_label = clusterv2,
ngene, numi, percent_mito, percent_ribo, ncount_rna, nfeature_rna) %>%
mutate_at(.vars = c("cluster_label"), .funs = tolower) %>%
mutate_at(.vars = c("cluster_label", "cell_type"),
.funs = ~ str_replace(., "^neuron", "excitatory_neuron") %>%
str_replace("radialglia|rg", "radial_glia") %>%
str_replace("([:digit:]+)[:alpha:]+$", "\\1"))
tmp <- metadata %>%
# rownames_to_column("cell_id") %>%
set_colnames(colnames(.) %>% tolower %>% str_replace_all("[.]", "_")) %>%
select(cell_id = cell_name, age, individual, brain_region = structure, area, lamina,
cell_type = cell_type_v2, cluster_label = clusterv2,
ngene, numi, percent_mito, percent_ribo, ncount_rna, nfeature_rna) %>%
mutate_at(.vars = c("cluster_label"), .funs = tolower) %>%
mutate_at(.vars = c("cluster_label", "cell_type"),
.funs = ~ str_replace(., "^neuron", "excitatory_neuron") %>%
str_replace("radialglia|rg", "radial_glia") %>%
str_replace("([:digit:]+)[:alpha:]+$", "\\1"))
View(tmp)
wholebrain_subset <- read_rds(here("data/whole_brain/wholebrain_v3.2.3_subset_0.05.rds"))
View(metadata)
View(tmp)
tmp %>% count(cell_type)
tmp <- metadata %>%
# rownames_to_column("cell_id") %>%
set_colnames(colnames(.) %>% tolower %>% str_replace_all("[.]", "_")) %>%
select(cell_id = cell_name, age, individual, brain_region = structure, area, lamina,
cell_type = cell_type_v2, cluster_label = clusterv2,
ngene, numi, percent_mito, percent_ribo, ncount_rna, nfeature_rna) %>%
mutate_at(.vars = c("cluster_label"), .funs = tolower) %>%
mutate_at(.vars = c("cluster_label", "cell_type"),
.funs = ~ str_replace_all(c("^neuron" = "excitatory_neuron",
"radialglia|rg" = "radial_glia",
"([:digit:]+)[:alpha:]+$" = "\\1"),
"vascular|endo" = "endothelial")
)
tmp <- metadata %>%
# rownames_to_column("cell_id") %>%
set_colnames(colnames(.) %>% tolower %>% str_replace_all("[.]", "_")) %>%
select(cell_id = cell_name, age, individual, brain_region = structure, area, lamina,
cell_type = cell_type_v2, cluster_label = clusterv2,
ngene, numi, percent_mito, percent_ribo, ncount_rna, nfeature_rna) %>%
mutate_at(.vars = c("cluster_label"), .funs = tolower) %>%
mutate_at(.vars = c("cluster_label", "cell_type"),
.funs = ~ str_replace_all(c("^neuron" = "excitatory_neuron",
"radialglia|rg" = "radial_glia",
"([:digit:]+)[:alpha:]+$" = "\\1",
"vascular|endo" = "endothelial"))
)
metadata %>%
# rownames_to_column("cell_id") %>%
set_colnames(colnames(.) %>% tolower %>% str_replace_all("[.]", "_")) %>%
select(cell_id = cell_name, age, individual, brain_region = structure, area, lamina,
cell_type = cell_type_v2, cluster_label = clusterv2,
ngene, numi, percent_mito, percent_ribo, ncount_rna, nfeature_rna) %>%
mutate_at(.vars = c("cluster_label"), .funs = tolower) %>%
mutate_at(.vars = c("cluster_label", "cell_type"),
.funs = ~ str_replace_all(c("^neuron" = "excitatory_neuron",
"radialglia|rg" = "radial_glia",
"([:digit:]+)[:alpha:]+$" = "\\1",
"vascular|endo" = "endothelial"))
)
tmp <- metadata %>%
# rownames_to_column("cell_id") %>%
set_colnames(colnames(.) %>% tolower %>% str_replace_all("[.]", "_")) %>%
select(cell_id = cell_name, age, individual, brain_region = structure, area, lamina,
cell_type = cell_type_v2, cluster_label = clusterv2,
ngene, numi, percent_mito, percent_ribo, ncount_rna, nfeature_rna) %>%
mutate_at(.vars = c("cluster_label"), .funs = tolower) %>%
mutate_at(.vars = c("cluster_label", "cell_type"),
.funs = ~ str_replace_all(string = .,
pattern = c("^neuron" = "excitatory_neuron",
"radialglia|rg" = "radial_glia",
"([:digit:]+)[:alpha:]+$" = "\\1",
"vascular|endo" = "endothelial"))
)
View(tmp)
tmp %>% count(cell_type)
tmp %>% count(individual)
tmp %>% count(brain_region, area)
source(here("browser/seurat_to_h5ad_func.R"))
seurat_object <- wholebrain_subset
seurat_object <- wholebrain_subset
source('~/cse-phd/second-trimester/browser/seurat_to_h5ad_func.R')
source('~/cse-phd/second-trimester/browser/seurat_to_h5ad_func.R')
seurat_object@meta.data <- cleanMetadataWholeBrain(seurat_object)
source('~/cse-phd/second-trimester/browser/seurat_to_h5ad_func.R')
seurat_object@meta.data <- cleanMetadataWholeBrain(seurat_object)
source('~/cse-phd/second-trimester/browser/seurat_to_h5ad_func.R')
seurat_object@meta.data <- cleanMetadataWholeBrain(seurat_object)
tmp <- seurat_object@meta.data %>%
# rownames_to_column("cell_id") %>%
set_colnames(colnames(.) %>% tolower %>% str_replace_all("[.]", "_")) %>%
select(cell_id = cell_name, age, individual, brain_region = structure, area, lamina,
cell_type = cell_type_v2, cluster_label = clusterv2,
ngene, numi, percent_mito, percent_ribo, ncount_rna, nfeature_rna) %>%
mutate_at(.vars = c("cluster_label"), .funs = tolower) %>%
mutate_at(.vars = c("cluster_label", "cell_type"),
.funs = ~ str_replace_all(string = .,
pattern = c("^neuron" = "excitatory_neuron",
"radialglia|rg" = "radial_glia",
"([:digit:]+)[:alpha:]+$" = "\\1",
"vascular|endo" = "endothelial")))
seurat_object
seurat_object@meta.data
source('~/cse-phd/second-trimester/browser/seurat_to_h5ad_func.R')
seurat_object@meta.data <- cleanMetadataWholeBrain(seurat_object)
seurat_object@meta.data %>% count(cell.name) %>% arrange(desc(n))
seurat_object@meta.data %>% filter(is.na(cell.name))
seurat_object@meta.data
seurat_object
seurat_object@assays$RNA@scale.data %>% glimpse
seurat_object@assays$RNA@scale.data %>% rownames %>% table
seurat_object@assays$RNA@scale.data %>% colnames %>% table
seurat_object@assays$RNA@scale.data %>% colnames %>% count
seurat_object@assays$RNA@scale.data %>% colnames %>% as_tibble %>% count
seurat_object@assays$RNA@scale.data %>% colnames %>% as_tibble
seurat_object@assays$RNA@scale.data %>% colnames %>% as_tibble %>% count(value)
seurat_object@assays$RNA@scale.data %>% colnames %>% as_tibble %>% count(value) %>% arrange(desc(n))
seurat_object@meta.data %>% filter(is.na(cell.name))
seurat_object@meta.data
seurat_object@assays$RNA@scale.data %>% dims
seurat_object@assays$RNA@scale.data %>% glimpse
metadata %>% filter(is.na(cell.name))
metadata %>% filter(is.na(cell.name))
metadata
seurat_object@meta.data
tmp %>% filter(is.na(cell.name))
metadata %>% filter(is.na(cell_id))
seurat_object <- wholebrain_subset
seurat_object@meta.data <- cleanMetadataWholeBrain(seurat_object)
tmp %>% filter(is.na(cell_id))
source('~/cse-phd/second-trimester/browser/seurat_to_h5ad_func.R')
seurat_object@meta.data <- cleanMetadataWholeBrain(seurat_object)
seurat_object@meta.data %>%
# rownames_to_column("cell_id") %>%
set_colnames(colnames(.) %>% tolower %>% str_replace_all("[.]", "_")) %>%
select(cell_id = cell_name, age, individual, brain_region = structure, area, lamina,
cell_type = cell_type_v2, cluster_label = clusterv2,
ngene, numi, percent_mito, percent_ribo) %>%
mutate_at(.vars = c("cluster_label"), .funs = tolower) %>%
mutate_at(.vars = c("cluster_label", "cell_type"),
.funs = ~ str_replace_all(string = .,
pattern = c("^neuron" = "excitatory_neuron",
"radialglia|rg" = "radial_glia",
"([:digit:]+)[:alpha:]+$" = "\\1",
"vascular|endo" = "endothelial"))) %>%
set_rownames(.$"cell_id")
# rownames_to_column("cell_id") %>%
set_colnames(colnames(.) %>% tolower %>% str_replace_all("[.]", "_")) %>%
select(cell_id = cell_name, age, individual, brain_region = structure, area, lamina,
cell_type = cell_type_v2, cluster_label = clusterv2,
ngene, numi, percent_mito, percent_ribo) %>%
mutate_at(.vars = c("cluster_label"), .funs = tolower) %>%
mutate_at(.vars = c("cluster_label", "cell_type"),
.funs = ~ str_replace_all(string = .,
pattern = c("^neuron" = "excitatory_neuron",
"radialglia|rg" = "radial_glia",
"([:digit:]+)[:alpha:]+$" = "\\1",
"vascular|endo" = "endothelial")))
tmp <- seurat_object@meta.data %>%
# rownames_to_column("cell_id") %>%
set_colnames(colnames(.) %>% tolower %>% str_replace_all("[.]", "_")) %>%
select(cell_id = cell_name, age, individual, brain_region = structure, area, lamina,
cell_type = cell_type_v2, cluster_label = clusterv2,
ngene, numi, percent_mito, percent_ribo) %>%
mutate_at(.vars = c("cluster_label"), .funs = tolower) %>%
mutate_at(.vars = c("cluster_label", "cell_type"),
.funs = ~ str_replace_all(string = .,
pattern = c("^neuron" = "excitatory_neuron",
"radialglia|rg" = "radial_glia",
"([:digit:]+)[:alpha:]+$" = "\\1",
"vascular|endo" = "endothelial")))
tmp %>% filter(is.na(cell_id))
seurat_object@meta.data %>% filter(is.na(cell.name))
View(metadata)
metadata %>% filter(is.na(cell.name))
wholebrain_subset@meta.data %>% filter(is.na(cell.name))
subsetSeurat()
subsetSeurat
wholebrain_subset %>% colnames
334/24000
subsetSeurat()
subsetSeurat
wholebrain_subset <- read_rds(here("data/whole_brain/wholebrain_v3.2.3_subset_0.05.rds"))
seurat_object <- wholebrain_subset
seurat_object@meta.data <- cleanMetadataWholeBrain(seurat_object)
seurat_object@meta.data
source('~/cse-phd/second-trimester/browser/seurat_to_h5ad_func.R')
seurat_object@meta.data <- cleanMetadataWholeBrain(seurat_object)
seurat_object@meta.data
source('~/cse-phd/second-trimester/browser/seurat_to_h5ad_func.R')
wholebrain_subset <- read_rds(here("data/whole_brain/wholebrain_v3.2.3_subset_0.05.rds"))
seurat_object <- wholebrain_subset
seurat_object@meta.data <- cleanMetadataWholeBrain(seurat_object)
seurat_object@meta.data
seurat_object@meta.data %>% count(cluster_label) %>% print(n=Inf)
wholebrain_subset <- seurat_object
write_rds(wholebrain_subset, small_object_path)
file_path = here("browser-dbx/data/210503_wholebrain_v3.2.3_subset.05.h5seurat")
small_object_path <- here("data/whole_brain/wholebrain_v3.2.3_subset_0.05.rds")
write_rds(wholebrain_subset, small_object_path)
source('~/cse-phd/second-trimester/browser/seurat_to_h5ad_func.R')
source('~/cse-phd/second-trimester/browser/seurat_to_h5ad_func.R')
seurat_object <- wholebrain_subset
seurat_object@meta.data <- cleanMetadataWholeBrain(seurat_object)
seurat_object@meta.data
seurat_object@meta.data %>% is.na
seurat_object@meta.data %>% filter_all(is.na)
seurat_object@meta.data
seurat_object@meta.data %<>% mutate(cell_type = case_when(str_detect(cell_id, "GW16") ~ str_replace(string = cell_type,
pattern = "(^[:alpha:]+_[:alpha:]+)_[:alpha:]+",
replacement = "\\1"),
TRUE ~ cell_type))
seurat_object@meta.data %>% count(brain_region, area)
seurat_object <- wholebrain_subset
seurat_object@meta.data %<>% mutate(      mutate(area = case_when(area == "V1" & !(brain_region == "neocortex") ~ brain_region,
TRUE ~ area)) %>%
set_rownames(.$"cell_id"))
seurat_object@meta.data %<>% mutate(area = case_when(area == "V1" & !(brain_region == "neocortex") ~ brain_region,
TRUE ~ area)) %>%
set_rownames(.$"cell_id")
seurat_object@meta.data %>% count(brain_region, area)
source('~/cse-phd/second-trimester/browser/seurat_to_h5ad_func.R')
wholebrain_subset <- seurat_object
write_rds(wholebrain_subset, small_object_path)
seurat_to_h5ad(seurat_object_path =  small_object_path,
file_path_out = here("browser-dbx/data/210503_wholebrain_v3.2.3_subset.05.h5seurat"))
here()
seurat_to_h5ad(seurat_object_path =  small_object_path,
file_path_out = here("browser-dbx/210503_wholebrain_v3.2.3_subset.05.h5seurat"))
seurat_to_h5ad(seurat_object_path =  small_object_path,
file_path_out = here("browser/browser-dbx/210503_wholebrain_v3.2.3_subset.05.h5seurat"))
wbH5 <- function(seurat_object, path_out_h5seurat) {
seurat_object@meta.data <- cleanMetadataWholeBrain(seurat_object)
# seurat_object@meta.data %>% count(cluster_label)
# wholebrain_subset <- seurat_object
# write_rds(wholebrain_subset, small_object_path)
seurat_to_h5ad(seurat_object =  seurat_object,
file_path_out = path_out_h5seurat)
}
reticulate::repl_python()
